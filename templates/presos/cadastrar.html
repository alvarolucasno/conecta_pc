{% extends 'partials/_base.html' %}

{% load static %}

{% block title %}Conecta PC | Presos{% endblock %}

{% block extra_head %}

{% endblock %}

{% block content %}
<div class="content-header">
  <div class="container-fluid">
    <div class="row mb-2">
      <div class="col-sm-6">
      </div>
      <div class="col-sm-6">
        <ol class="breadcrumb float-sm-right">
          <li class="breadcrumb-item"><a href="#">Serviços</a></li>
          <li class="breadcrumb-item active">Presos</li>
          <li class="breadcrumb-item active">Cadastrar</li>
        </ol>
      </div>
    </div>
  </div>
</div>

<section class="content">
  <div class="container-fluid">
    <div class="row">
      <div class="col-12">
        <div class="card">
          <div class="card-body">
            <div class="card card-primary">
              <div class="card-header">
                <h3 class="card-title">Dados do preso</h3>
              </div>
              <div class="card-body">
                <form method="post" enctype="multipart/form-data">
                  {% csrf_token %}
                  <div class="form-row">
                    <div class="form-group col-md-4 text-center">
                      <div class="drop-area" id="dropArea1" style="border: 2px dashed #ccc; border-radius: 10px; padding: 10px;">
                        <img id="uploadedImage1" src="https://static.vecteezy.com/ti/vetor-gratis/p1/2331588-icone-identidade-oculta-pessoa-desconhecida-vetor.jpg" alt="Imagem padrão" style="max-width: 300px; max-height: 400px;" draggable="true">
                        <div class="d-flex justify-content-center align-items-center" style="height: 50px;">Foto do lado direito</div>
                        <input type="file" id="inputImage1" accept="image/*" style="display: none;">
                      </div>
                    </div>
                    <div class="form-group col-md-4 text-center">
                      <div class="drop-area" id="dropArea2" style="border: 2px dashed #ccc; border-radius: 10px; padding: 10px;">
                        <img id="uploadedImage2" src="https://static.vecteezy.com/ti/vetor-gratis/p1/2331588-icone-identidade-oculta-pessoa-desconhecida-vetor.jpg" alt="Imagem padrão" style="max-width: 300px; max-height: 400px;" draggable="true">
                        <div class="d-flex justify-content-center align-items-center" style="height: 50px;">Foto frontal</div>
                        <input type="file" id="inputImage2" accept="image2/*" style="display: none;">
                      </div>
                    </div>
                    <div class="form-group col-md-4 text-center">
                      <div class="drop-area" id="dropArea3" style="border: 2px dashed #ccc; border-radius: 10px; padding: 10px;">
                        <img id="uploadedImage3" src="https://static.vecteezy.com/ti/vetor-gratis/p1/2331588-icone-identidade-oculta-pessoa-desconhecida-vetor.jpg" alt="Imagem padrão" style="max-width: 300px; max-height: 400px;" draggable="true">
                        <div class="d-flex justify-content-center align-items-center" style="height: 50px;">Foto do lado esquerdo</div>
                        <input type="file" id="inputImage3" accept="image/*" style="display: none;">
                      </div>
                    </div>                                        
                  </div> 
                    <div class="form-row">
                      <div class="form-group col-md-2">
                        <label for="dataNascimento">Data da Foto:</label>
                        <input type="date" class="form-control" id="dataNascimento" name="dataNascimento" min="1900-01-01">
                      </div>
                      <div class="form-group col-md-2">
                        <label for="origemFoto">Origem da Foto:</label>
                        <select class="form-control" id="origemFoto" name="origemFoto">
                          <option>1ª DM</option>
                          <option>2ª DM</option>
                          <option>3ª DM</option>
                          <option>4ª DM</option>
                          <option>5ª DM</option>
                          <option>8ª DM</option>
                          <option>COPE</option>
                        </select>
                      </div>
                      <div class="form-group col-md-6">
                        <label for="nomeCompleto">Nome Completo:</label>
                        <input type="text" class="form-control" id="nomeCompleto" name="nomeCompleto" required>
                      </div>
                      <div class="form-group col-md-2">
                        <label for="dataNascimento">Data de Nascimento:</label>
                        <input type="date" class="form-control" id="dataNascimento" name="dataNascimento" min="1900-01-01">
                      </div>
                    </div>

                    <div class="form-row">
                      
                      <div class="form-group col-md-4">
                        <label for="mae">Mãe:</label>
                        <input type="text" class="form-control" id="mae" name="mae">
                      </div>
                      <div class="form-group col-md-4">
                        <label for="pai">Pai:</label>
                        <input type="text" class="form-control" id="pai" name="pai">
                      </div>
                      <div class="form-group col-md-2">
                        <label for="rg">RG:</label>
                        <input type="text" class="form-control" id="rg" name="rg" pattern="\d*" inputmode="numeric" title="Por favor, insira apenas números.">
                      </div>

                      <div class="form-group col-md-2">
                        <label for="uf_rg">UF do RG:</label>
                        <select class="form-control" id="uf_rg" name="uf_rg">
                          <option value="AC">Acre</option>
                          <option value="AL">Alagoas</option>
                          <option value="AP">Amapá</option>
                          <option value="AM">Amazonas</option>
                          <option value="BA">Bahia</option>
                          <option value="CE">Ceará</option>
                          <option value="DF">Distrito Federal</option>
                          <option value="ES">Espírito Santo</option>
                          <option value="GO">Goiás</option>
                          <option value="MA">Maranhão</option>
                          <option value="MT">Mato Grosso</option>
                          <option value="MS">Mato Grosso do Sul</option>
                          <option value="MG">Minas Gerais</option>
                          <option value="PA">Pará</option>
                          <option value="PB">Paraíba</option>
                          <option value="PR">Paraná</option>
                          <option value="PE">Pernambuco</option>
                          <option value="PI">Piauí</option>
                          <option value="RJ">Rio de Janeiro</option>
                          <option value="RN">Rio Grande do Norte</option>
                          <option value="RS">Rio Grande do Sul</option>
                          <option value="RO">Rondônia</option>
                          <option value="RR">Roraima</option>
                          <option value="SC">Santa Catarina</option>
                          <option value="SP">São Paulo</option>
                          <option value="SE">Sergipe</option>
                          <option value="TO">Tocantins</option>
                        </select>
                      </div>
                    </div>

                    <div class="form-row">
                      
                      <div class="form-group col-md-2">
                        <label for="cpf">CPF:</label>
                        <input type="text" class="form-control" id="cpf" name="cpf" pattern="\d{3}\.\d{3}\.\d{3}-\d{2}" title="Por favor, insira o CPF completo...">
                      </div>

                      <div class="form-group col-md-2">
                        <label for="cnh">CNH:</label>
                        <input type="text" class="form-control" id="cnh" name="cnh" pattern="\d*" inputmode="numeric" title="Por favor, insira apenas números.">
                      </div>
                      <div class="form-group col-md-2">
                        <label for="nis">NIS:</label>
                        <input type="text" class="form-control" id="nis" name="nis" pattern="\d*" inputmode="numeric" title="Por favor, insira apenas números.">
                      </div>
                      <div class="form-group col-md-1">
                        <label for="sap">SAP:</label>
                        <input type="text" class="form-control" id="sap" name="sap" pattern="\d*" inputmode="numeric" title="Por favor, insira apenas números.">
                      </div>

                      <div class="form-group col-md-2">
                        <label for="cadastrador">Razão da prisão</label>
                        <select class="form-control" id="morto" name="morto">
                          <option value="0">Mandado de Prisão</option>
                          <option value="1">APF</option>
                        </select>
                      </div>
                      <div class="form-group col-md-3">
                        <label for="sap">Número:</label>
                        <input type="text" class="form-control" id="sap" name="sap" pattern="\d*" inputmode="numeric" title="Por favor, insira apenas números.">
                      </div>
                    </div>

                    <div class="form-row">
                      <div class="form-group col-md-9">
                        <label for="observacao">Observação:</label>
                        <input type="text" class="form-control" id="observacao" name="observacao">
                      </div>
                      <div class="form-group col-md-3 d-flex align-items-end justify-content-between">
                        <button type="submit" class="btn btn-primary" style="width: 48%;">Enviar</button>
                        <a href="/mandados" class="btn btn-danger" style="width: 48%;">Cancelar</a>
                      </div>
                    </div>
                  </form>
              </div>
            </div>
          </div>
        </div>
      </div>
    </div>
  </div>
</section>
</div>

<div class="modal fade" id="cropperModal" tabindex="-1" role="dialog" aria-labelledby="modalLabel" aria-hidden="true">
  <div class="modal-dialog" role="document">
    <div class="modal-content">
      <div class="modal-header">
        <h5 class="modal-title" id="modalLabel">Corte a imagem</h5>
        <button type="button" class="close" data-dismiss="modal" aria-label="Close">
          <span aria-hidden="true">×</span>
        </button>
      </div>
      <div class="modal-body">
        <div class="img-container">
          <img id="image" src="">
        </div>
      </div>
      <div class="modal-footer">
        <button type="button" class="btn btn-secondary" data-dismiss="modal">Cancelar</button>
        <button type="button" class="btn btn-primary" id="cropAndUpload">Cortar e Upload</button>
      </div>
    </div>
  </div>
</div>
</div>

{% endblock %}

{% block extra_scripts %}
<script src="{% static 'plugins/cropper/jquery.min.js' %}" crossorigin="anonymous"></script>
<script src="{% static 'plugins/cropper/bootstrap.bundle.min.js' %}" crossorigin="anonymous"></script>
<script src="{% static 'plugins/cropper/cropper.js' %}"></script>

<script>
  // Uma função para processar os arquivos para todas as áreas de drop
  function processFiles(files, dropAreaNum) {
    if (files && files.length) {
      var file = files[0];
      if (/^image\/\w+/.test(file.type)) {
        var reader = new FileReader();
        reader.onload = function (e) {
          document.getElementById('image').src = e.target.result;
          $('#cropperModal').modal('show');
          document.getElementById('cropAndUpload').setAttribute('data-drop-area', dropAreaNum);
        };
        reader.readAsDataURL(file);
        document.getElementById('inputImage' + dropAreaNum).files = files;
      } else {
        window.alert('Por favor, selecione um arquivo de imagem.');
      }
    }
  }

  // Configuração de eventos para cada área de drop
  for (let i = 1; i <= 3; i++) {
    let dropArea = document.getElementById('dropArea' + i);
    let inputImage = document.getElementById('inputImage' + i);
    
    dropArea.onclick = function() {
      inputImage.click();
    };

    dropArea.addEventListener('dragover', function(e) {
      e.preventDefault();
    });

    dropArea.addEventListener('drop', function(e) {
      e.preventDefault();
      var files = e.dataTransfer.files;
      processFiles(files, i);
    });

    inputImage.addEventListener('change', function (event) {
      var files = event.target.files;
      processFiles(files, i);
    });
  }

  // Modal Cropper.js
  var cropper;
  $('#cropperModal').on('shown.bs.modal', function () {
    cropper = new Cropper(document.getElementById('image'), {
      aspectRatio: 3 / 4,
      viewMode: 1
    });
  }).on('hidden.bs.modal', function () {
    cropper.destroy();
    cropper = null;
  });

  // Manipulação do evento de corte e upload
  document.getElementById('cropAndUpload').addEventListener('click', function () {
    var dropAreaNum = this.getAttribute('data-drop-area');
    if (cropper) {
      cropper.getCroppedCanvas().toBlob(function (blob) {
        document.getElementById('uploadedImage' + dropAreaNum).src = URL.createObjectURL(blob);
        $('#cropperModal').modal('hide');
        // Implementação de upload seria aqui
      });
    }
  });
</script>

<script>
  document.addEventListener("DOMContentLoaded", function() {
    const cpfInput = document.getElementById("cpf");

    cpfInput.addEventListener("input", function(e) {
      let value = e.target.value;
      value = value.replace(/\D/g, "");
      value = value.replace(/(\d{3})(\d)/, "$1.$2");
      value = value.replace(/(\d{3})\.(\d{3})(\d)/, "$1.$2.$3");
      value = value.replace(/(\d{3})\.(\d{3})\.(\d{3})(\d)/, "$1.$2.$3-$4");
      e.target.value = value.substring(0, 14);
    });
  });

  document.addEventListener("DOMContentLoaded", function() {
    const inputs = ['rg', 'cnh', 'nis', 'sap'];

    inputs.forEach(function(inputId) {
      const inputElem = document.getElementById(inputId);

      inputElem.addEventListener("input", function(e) {
        e.target.value = e.target.value.replace(/\D/g, "");
      });
    });
  });

  document.addEventListener("DOMContentLoaded", function() {
    function formatarNome(e) {
      let value = e.target.value;
      value = value.replace(/[^a-zA-Z\sáéíóúÁÉÍÓÚçÇãõÃÕ]/g, "");
      let palavras = value.split(" ");
      let palavrasFormatadas = [];
      const palavrasMinusculas = ["de", "do", "da", "dos", "das"];

      for (let palavra of palavras) {
        if (palavrasMinusculas.includes(palavra.toLowerCase())) {
          palavrasFormatadas.push(palavra.toLowerCase());
        } else {
          let palavraFormatada = palavra.charAt(0).toUpperCase() + palavra.slice(1).toLowerCase();
          palavrasFormatadas.push(palavraFormatada);
        }
      }

      let nomeFormatado = palavrasFormatadas.join(" ");
      e.target.value = nomeFormatado;
    }

    const nomeCompletoInput = document.getElementById("nomeCompleto");
    nomeCompletoInput.addEventListener("input", formatarNome);

    const maeInput = document.getElementById("mae");
    maeInput.addEventListener("input", formatarNome);

    const paiInput = document.getElementById("pai");
    paiInput.addEventListener("input", formatarNome);
  });
</script>
{% endblock %}


